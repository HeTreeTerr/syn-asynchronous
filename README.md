# 1.接口对接心得
## 1.1接口请求归纳
在开发过程中，因为业务需要，不可避免的需要和第三方的服务进行接口对接。  
第三方可能作为甲方，下文中统称为‘上游’；  
第三方可能作为乙方，下文中统称为‘下游’；  
  
一般拿到上下游接口文档后，最关心的是接口以下三个方面：
* 加密方式（一般联调过程中，会交换加解密的工具类）；
* 可以提供的字段（接口文档中有详细说明）；
* 逻辑处理结果是同步返回还是异步返回（会影响程序运行的时序，严重时导致
上下游流程打通失败）；

## 1.2同步异步兼容
### 1.2.1规则总结
* 规则1  
上游要求同步，那么下游只能同步；
上游要求异步，那么下游可以同步可以异步；
* 规则2  
上游要求同步时：  
**作为下游**，
只能对外提供同步接口，接受请求参数，执行处理逻辑，实时返回结果；   
**作为上游**，
只有下游接口成功返回处理结果时，才保存处理结果，修改标识；
下游接口请求失败，则事务回滚，以支持重复请求下游接口；  

* 规则3  
上游要求异步时：  
**作为上游**，
主动调用下游提供的接口，同时提供回调接口，供下游返回处理结果；  
**作为下游**，
对上游提供接口，用于接收上游请求参数；  
如果下游打算同步处理逻辑，接收请求参数，逻辑处理，上游接口回调； 
如果下游打算异步处理逻辑，接收请求参数，返回受理成功，异步进行逻辑处理和上游接口回调；

### 1.2.2定义标识
**status**  
代表逻辑处理的状态，字段说明：  
默认值0(未处理)，不为空；
只有当服务的提供方返回处理成功，才修改标识为 1(处理成功)；
2(处理失败)；  

**submitFlag**  
代表通知的状态，字段说明：
默认值0(未通知)；
只有成功请求下游，并返回请求成功，才修改为1(通知下游)；
成功拿到处理结果，通知上游处理结果，通知成功，则修改为2(通知上游)

### 1.2.3下游兼容配置
>消费者指上游，提供者值下游
```yaml
myapp:
  config:
    #取决于消费者同步还是异步[消费者同步，所有操作必须同步；消费者异步，有配置和补偿空间]
    synOrAsy: asy
    #消费者接受异步，但不想等待太长的时间。
    fastOrSlow: slow
    #核心逻辑处理可能需要请求第三方服务，第三方服务是同步还是异步
    coreSynOrAsy: asy
```

## 1.3仓库代码
### 1.3.1文档
**有道云文档**：  
同异步定义和特点.note
链接：http://note.youdao.com/noteshare?id=621c8589a71c3d77cc8750536a7795d0&sub=4B2B337791D24979B44AF0F43DEC4997  
**postman接口文档**：  
consumer-service>src>main>resources>syn&&asy.postman_collection.json

### 1.3.2代码使用
1. 确定提供者的需求，修改消费者配置以适配提供者的需求；
2. 启动提供者和消费者，对外提供服务；
3. 调用接口，观察逻辑处理细节；